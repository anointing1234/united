{% load static %}
{% load humanize %}
<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">

  <!-- SEO Meta Tags -->
  <title>Dashboard - BankUnited | Online Banking, Savings & Financial Services</title>
  <meta name="description" content="BankUnited offers secure checking, savings, loans, and online banking services. Open an account today and experience financial confidence.">
  <meta name="keywords" content="BankUnited, online banking, open bank account, savings account, checking account, loans, financial services, ATM network, mobile banking">
  <meta name="author" content="BankUnited">
  <meta name="robots" content="index, follow">

  <!-- Open Graph (Facebook/LinkedIn) -->
  <meta property="og:title" content="BankUnited - Online Banking & Financial Services">
  <meta property="og:description" content="Secure checking, savings, and online banking with BankUnited. Open an account today.">
  <meta property="og:image" content="{% static 'images/logo.png' %}">
  <meta property="og:url" content="https://www.bankunited.com/">
  <meta property="og:type" content="website">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="BankUnited - Online Banking & Financial Services">
  <meta name="twitter:description" content="BankUnited offers checking, savings, and secure mobile banking.">
  <meta name="twitter:image" content="{% static 'images/logo.png' %}">

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="{% static 'images/favicon.png' %}" sizes="16x16">

  <!-- CSS: Wowdash Assets -->
  <link rel="stylesheet" href="{% static 'asset/css/remixicon.css' %}">
  <link rel="stylesheet" href="{% static 'asset/css/lib/bootstrap.min.css' %}">
  <link rel="stylesheet" href="{% static 'asset/css/lib/apexcharts.css' %}">
  <link rel="stylesheet" href="{% static 'asset/css/lib/dataTables.min.css' %}">
  <link rel="stylesheet" href="{% static 'asset/css/lib/editor-katex.min.css' %}">
  <link rel="stylesheet" href="{% static 'asset/css/lib/editor.atom-one-dark.min.css' %}">
  <link rel="stylesheet" href="{% static 'asset/css/lib/editor.quill.snow.css' %}">
  <link rel="stylesheet" href="{% static 'asset/css/lib/flatpickr.min.css' %}">
  <link rel="stylesheet" href="{% static 'asset/css/lib/full-calendar.css' %}">
  <link rel="stylesheet" href="{% static 'asset/css/lib/jquery-jvectormap-2.0.5.css' %}">
  <link rel="stylesheet" href="{% static 'asset/css/lib/magnific-popup.css' %}">
  <link rel="stylesheet" href="{% static 'asset/css/lib/slick.css' %}">
  <link rel="stylesheet" href="{% static 'asset/css/lib/prism.css' %}">
  <link rel="stylesheet" href="{% static 'asset/css/lib/file-upload.css' %}">
  <link rel="stylesheet" href="{% static 'asset/css/lib/audioplayer.css' %}">
  <link rel="stylesheet" href="{% static 'asset/css/style.css' %}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />

  <!-- SweetAlert2 for Alerts -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <!-- Structured Data (Schema.org JSON-LD) -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BankOrCreditUnion",
    "name": "BankUnited",
    "url": "https://www.bankunited.com/",
    "logo": "https://www.bankunited.com{% static 'images/logo.png' %}",
    "description": "BankUnited offers checking, savings, loans, and secure online banking services.",
    "sameAs": [
      "https://www.facebook.com/BankUnited",
      "https://twitter.com/BankUnited",
      "https://www.linkedin.com/company/bankunited"
    ],
    "contactPoint": {
      "@type": "ContactPoint",
      "telephone": "+1-800-123-4567",
      "contactType": "customer service",
      "areaServed": "US",
      "availableLanguage": ["English", "Spanish"]
    }
  }
  </script>
</head>

<body>
  <aside class="sidebar">
    <button type="button" class="sidebar-close-btn">
      <iconify-icon icon="lucide:x"></iconify-icon>
    </button>
    <div>
      <a href="{% url 'dashboard' %}" class="sidebar-logo">
        <img src="{% static 'images/logo.png' %}" alt="site logo" class="light-logo">
        <img src="{% static 'images/logo.png' %}" alt="site logo" class="dark-logo">
        <img src="{% static 'images/logo.png' %}" alt="site logo" class="logo-icon">
      </a>
    </div>
    <div class="sidebar-menu-area">
      <ul class="sidebar-menu" id="sidebar-menu">
        <li>
          <a href="{% url 'dashboard' %}">
            <iconify-icon icon="lucide:home" class="menu-icon"></iconify-icon>
            <span>Dashboard</span>
          </a>
        </li>
        <li class="sidebar-menu-group-title">Transactions</li>
        <li>
          <a href="{% url 'local_transfer' %}">
            <iconify-icon icon="lucide:send" class="menu-icon"></iconify-icon>
            <span>Local Transfer</span>
          </a>
        </li>
        <li>
          <a href="{% url 'international_transfer' %}">
            <iconify-icon icon="lucide:globe" class="menu-icon"></iconify-icon>
            <span>International Transfer</span>
          </a>
        </li>
        <li>
          <a href="{% url 'deposit' %}">
            <iconify-icon icon="lucide:plus-circle" class="menu-icon"></iconify-icon>
            <span>Deposit</span>
          </a>
        </li>
        <li class="sidebar-menu-group-title">Services</li>
        <li>
          <a href="{% url 'loans' %}">
            <iconify-icon icon="lucide:file-text" class="menu-icon"></iconify-icon>
            <span>Loans</span>
          </a>
        </li>
        <li>
          <a href="{% url 'grants' %}">
            <iconify-icon icon="lucide:award" class="menu-icon"></iconify-icon>
            <span>Grants</span>
          </a>
        </li>
        <li class="sidebar-menu-group-title">Settings</li>
        <li>
          <a href="mailto:info@bankunited.com">
            <iconify-icon icon="lucide:life-buoy" class="menu-icon"></iconify-icon>
            <span>Support</span>
          </a>
        </li>
        <li>
          <a href="{% url 'profile' %}">
            <iconify-icon icon="lucide:settings" class="menu-icon"></iconify-icon>
            <span>Settings</span>
          </a>
        </li>
      </ul>
    </div>
  </aside>

  <main class="dashboard-main">
    <div class="navbar-header">
      <div class="row align-items-center justify-content-between">
        <div class="col-auto">
          <div class="d-flex flex-wrap align-items-center gap-4">
            <button type="button" class="sidebar-toggle">
              <iconify-icon icon="heroicons:bars-3-solid" class="icon text-2xl non-active"></iconify-icon>
              <iconify-icon icon="iconoir:arrow-right" class="icon text-2xl active"></iconify-icon>
            </button>
            <button type="button" class="sidebar-mobile-toggle">
              <iconify-icon icon="heroicons:bars-3-solid" class="icon"></iconify-icon>
            </button>
          </div>
        </div>
        <div class="col-auto">
          <div class="d-flex flex-wrap align-items-center gap-3">
            <button type="button" data-theme-toggle class="w-40-px h-40-px bg-neutral-200 rounded-circle d-flex justify-content-center align-items-center"></button>
            <div>
              <button class="d-flex justify-content-center align-items-center rounded-circle" type="button" data-bs-toggle="dropdown">
                {% if request.user.profile_pic %}
                  <img src="{{ request.user.profile_pic.url }}" alt="image" class="w-40-px h-40-px object-fit-cover rounded-circle">
                {% else %}
                  <img src="{% static 'asset/images/user-grid/user-grid-img13.png' %}" alt="image" class="w-40-px h-40-px object-fit-cover rounded-circle">
                {% endif %}
              </button>
              <div class="dropdown-menu to-top dropdown-menu-sm">
                <div class="py-12 px-16 radius-8 bg-primary-50 mb-16 d-flex align-items-center justify-content-between gap-2">
                  <div>
                    <h6 class="text-lg text-primary-light fw-semibold mb-2">{{ request.user.username }}</h6>
                  </div>
                  <button type="button" class="hover-text-danger">
                    <iconify-icon icon="radix-icons:cross-1" class="icon text-xl"></iconify-icon>
                  </button>
                </div>
                <ul class="to-top-list">
                  <li>
                    <a class="dropdown-item text-black px-0 py-8 hover-bg-transparent hover-text-primary d-flex align-items-center gap-3" href="{% url 'profile' %}">
                      <iconify-icon icon="solar:user-linear" class="icon text-xl"></iconify-icon> My Profile
                    </a>
                  </li>
                  <li>
                    <a class="dropdown-item text-black px-0 py-8 hover-bg-transparent hover-text-danger d-flex align-items-center gap-3" href="{% url 'logout' %}">
                      <iconify-icon icon="lucide:power" class="icon text-xl"></iconify-icon> Log Out
                    </a>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="dashboard-main-body">
      <div class="d-flex flex-wrap align-items-center justify-content-between gap-3 mb-24">
        <h6 class="fw-semibold mb-0">My Profile</h6>
        <ul class="d-flex align-items-center gap-2">
          <li class="fw-medium">
            <a href="{% url 'dashboard' %}" class="d-flex align-items-center gap-1 hover-text-primary">
              <iconify-icon icon="solar:home-smile-angle-outline" class="icon text-lg"></iconify-icon>
              Dashboard
            </a>
          </li>
          <li>-</li>
          <li class="fw-medium">My Profile</li>
        </ul>
      </div>

      <div class="row gy-4">
        <!-- Left: User Info -->
        <div class="col-lg-4">
          <div class="user-grid-card position-relative border radius-16 overflow-hidden bg-base">
            <div class="ms-16 me-16 mt-n5">
              <div class="text-center border-bottom mt-5 pt-5">
                <!-- Avatar Upload -->
                <div class="mb-24 mt-16 d-flex justify-content-center">
                  <form id="profile-form" method="post" enctype="multipart/form-data" action="{% url 'account' %}">
                   {% csrf_token %}
                  <div class="avatar-upload position-relative">
                    <div class="avatar-edit position-absolute bottom-0 end-0 me-24 z-1 cursor-pointer">
                      <input type="file" id="imageUpload" name="profile_pic" accept=".png, .jpg, .jpeg" hidden>
                      <label for="imageUpload" class="w-32-px h-32-px d-flex justify-content-center align-items-center bg-primary-50 text-primary-600 border border-primary-600 bg-hover-primary-100 rounded-circle">
                        <iconify-icon icon="solar:camera-outline" class="icon"></iconify-icon>
                      </label>
                    </div>
                    <div class="avatar-preview">
                      <div id="imagePreview" style="background-image: url(
                        {% if request.user.profile_pic %}
                          {{ request.user.profile_pic.url }}
                        {% else %}
                          {% static 'asset/images/user-grid/user-grid-img13.png' %}
                        {% endif %}
                        ); background-size: cover; background-position: center;">
                      </div>
                    </div>
                  </div>
                </div>
                <h6 class="mb-0 mt-16">{{ request.user.username }}</h6>
                <span class="text-secondary-light mb-16">{{ request.user.email }}</span>
              </div>
              <div class="mt-24 mb-5">
                <h6 class="text-xl mb-16">Personal Info</h6>
                <ul>
                  <li class="d-flex mb-12"><strong class="w-30">Full Name:</strong> <span class="w-70">{{ request.user.first_name }} {{ request.user.last_name }}</span></li>
                  <li class="d-flex mb-12"><strong class="w-30">Phone:</strong> <span class="w-70">{{ request.user.phone_number }}</span></li>
                  <li class="d-flex mb-12"><strong class="w-30">Pin:</strong> <span class="w-70">{{ request.user.raw_transaction_pin }}</span></li>
                  <li class="d-flex mb-12"><strong class="w-30">Country:</strong> <span class="w-70">{{ request.user.country }}</span></li>
                  <li class="d-flex mb-12"><strong class="w-30">City:</strong> <span class="w-70">{{ request.user.city }}</span></li>
                  <li class="d-flex"><strong class="w-30">Gender:</strong>
                    <span class="w-70">
                      {% if request.user.gender == "M" %} Male
                      {% elif request.user.gender == "F" %} Female
                      {% else %} Other
                      {% endif %}
                    </span>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>
        <!-- Right: Edit Profile Tabs -->
        <div class="col-lg-8">
          <div class="card h-100">
            <div class="card-body p-24">
              <ul class="nav border-gradient-tab nav-pills mb-20 d-inline-flex" id="pills-tab" role="tablist">
                <li class="nav-item" role="presentation">
                  <button class="nav-link active" id="pills-edit-profile-tab" data-bs-toggle="pill" data-bs-target="#pills-edit-profile" type="button" role="tab">
                    Edit Profile
                  </button>
                </li>
                <li class="nav-item" role="presentation">
                  <button class="nav-link" id="pills-change-password-tab" data-bs-toggle="pill" data-bs-target="#pills-change-password" type="button" role="tab">
                    Change Password
                  </button>
                </li>
              </ul>
              <div class="tab-content" id="pills-tabContent">
                <!-- Edit Profile -->
                <div class="tab-pane fade show active" id="pills-edit-profile" role="tabpanel">
             
                    <input type="hidden" name="update_profile" value="1">
                    <div class="row">
                      <div class="col-sm-6 mb-20">
                        <label for="full_name" class="form-label">Full Name *</label>
                        <input type="text" class="form-control radius-8" id="full_name" name="full_name" value="{{ request.user.first_name }} {{ request.user.last_name }}" placeholder="Enter Full Name" required>
                      </div>
                      <div class="col-sm-6 mb-20">
                        <label for="email" class="form-label">Email *</label>
                        <input type="email" class="form-control radius-8" id="email" name="email" value="{{ request.user.email }}" placeholder="Enter Email" required>
                      </div>
                      <div class="col-sm-6 mb-20">
                        <label for="phone" class="form-label">Phone</label>
                        <input type="text" class="form-control radius-8" id="phone" name="phone_number" value="{{ request.user.phone_number }}" placeholder="Enter Phone">
                      </div>
                      <div class="col-sm-6 mb-20">
                        <label for="country" class="form-label">Country</label>
                        <input type="text" class="form-control radius-8" id="country" name="country" value="{{ request.user.country }}" placeholder="Enter Country">
                      </div>
                      <div class="col-sm-6 mb-20">
                        <label for="city" class="form-label">City</label>
                        <input type="text" class="form-control radius-8" id="city" name="city" value="{{ request.user.city }}" placeholder="Enter City">
                      </div>
                      <div class="col-sm-6 mb-20">
                        <label for="gender" class="form-label">Gender</label>
                        <select class="form-control radius-8" id="gender" name="gender">
                          <option value="" {% if not request.user.gender %}selected{% endif %}>Select Gender</option>
                          <option value="M" {% if request.user.gender == "M" %}selected{% endif %}>Male</option>
                          <option value="F" {% if request.user.gender == "F" %}selected{% endif %}>Female</option>
                          <option value="O" {% if request.user.gender == "O" %}selected{% endif %}>Other</option>
                        </select>
                      </div>
                    </div>
                    <div class="d-flex justify-content-center gap-3">
                      <button type="reset" class="btn btn-outline-danger">Cancel</button>
                      <button type="submit" name="update_profile" value="1" class="btn btn-primary">Save</button>
                    </div>
                  </form>
                </div>
                <!-- Change Password -->
                <div class="tab-pane fade" id="pills-change-password" role="tabpanel">
                  <form id="password-form" method="post" action="{% url 'account' %}">
                    {% csrf_token %}
                    <input type="hidden" name="change_password" value="1">
                    <div class="mb-20 position-relative">
                      <label for="old-password" class="form-label">Current Password *</label>
                      <input type="password" class="form-control radius-8" id="old-password" name="old_password" required>
                      <button type="button" class="toggle-password position-absolute" style="right: 10px; top: 70%; transform: translateY(-50%); border: none; background: transparent;">
                        <iconify-icon icon="ri:eye-line" class="eye-open"></iconify-icon>
                        <iconify-icon icon="ri:eye-off-line" class="eye-closed hidden"></iconify-icon>
                      </button>
                    </div>
                    <div class="mb-20 position-relative">
                      <label for="new-password" class="form-label">New Password *</label>
                      <input type="password" class="form-control radius-8" id="new-password" name="new_password1" required>
                      <button type="button" class="toggle-password position-absolute" style="right: 10px; top: 70%; transform: translateY(-50%); border: none; background: transparent;">
                        <iconify-icon icon="ri:eye-line" class="eye-open"></iconify-icon>
                        <iconify-icon icon="ri:eye-off-line" class="eye-closed hidden"></iconify-icon>
                      </button>
                    </div>
                    <div class="mb-20 position-relative">
                      <label for="confirm-password" class="form-label">Confirm Password *</label>
                      <input type="password" class="form-control radius-8" id="confirm-password" name="new_password2" required>
                      <button type="button" class="toggle-password position-absolute" style="right: 10px; top: 70%; transform: translateY(-50%); border: none; background: transparent;">
                        <iconify-icon icon="ri:eye-line" class="eye-open"></iconify-icon>
                        <iconify-icon icon="ri:eye-off-line" class="eye-closed hidden"></iconify-icon>
                      </button>
                    </div>
                    <div class="d-flex justify-content-center gap-3">
                      <button type="submit" name="change_password" value="1" class="btn btn-primary">Update Password</button>
                    </div>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <footer class="d-footer">
      <div class="row align-items-center justify-content-between">
        <div class="col-auto">
          <p class="mb-0">Copyright &copy; <script>document.write(new Date().getFullYear());</script> All Rights Reserved | BankUnited</p>
        </div>
      </div>
    </footer>
  </main>

  <!-- jQuery library js -->
  <script src="{% static 'asset/js/lib/jquery-3.7.1.min.js' %}"></script>
  <!-- Bootstrap js -->
  <script src="{% static 'asset/js/lib/bootstrap.bundle.min.js' %}"></script>
  <!-- Apex Chart js -->
  <script src="{% static 'asset/js/lib/apexcharts.min.js' %}"></script>
  <!-- Data Table js -->
  <script src="{% static 'asset/js/lib/dataTables.min.js' %}"></script>
  <!-- Iconify Font js -->
  <script src="{% static 'asset/js/lib/iconify-icon.min.js' %}"></script>
  <!-- jQuery UI js -->
  <script src="{% static 'asset/js/lib/jquery-ui.min.js' %}"></script>
  <!-- Vector Map js -->
  <script src="{% static 'asset/js/lib/jquery-jvectormap-2.0.5.min.js' %}"></script>
  <script src="{% static 'asset/js/lib/jquery-jvectormap-world-mill-en.js' %}"></script>
  <!-- Popup js -->
  <script src="{% static 'asset/js/lib/magnifc-popup.min.js' %}"></script>
  <!-- Slick Slider js -->
  <script src="{% static 'asset/js/lib/slick.min.js' %}"></script>
  <!-- Prism js -->
  <script src="{% static 'asset/js/lib/prism.js' %}"></script>
  <!-- File upload js -->
  <script src="{% static 'asset/js/lib/file-upload.js' %}"></script>
  <!-- Audioplayer -->
  <script src="{% static 'asset/js/lib/audioplayer.js' %}"></script>
  <!-- Main js -->
  <script src="{% static 'asset/js/app.js' %}"></script>
  <script src="{% static 'asset/js/homeOneChart.js' %}"></script>

  <!-- Custom Script -->
<script>
  // Inject custom SweetAlert2 styles
  const style = document.createElement('style');
  style.textContent = `
      /* General popup size */
      .custom-swal-popup {
          font-size: 0.8rem !important;
          padding: 1rem !important;
          max-width: 450px !important;
      }

      /* Title */
      .custom-swal-popup .swal2-title {
          font-size: 1rem !important;
          font-weight: 600 !important;
          margin-bottom: 0.5rem !important;
      }

      /* Text */
      .custom-swal-popup .swal2-html-container,
      .custom-swal-popup .swal2-content {
          font-size: 0.8rem !important;
          line-height: 1.3 !important;
      }

      /* Buttons */
      .custom-swal-button {
          background-color: #000000 !important;
          color: #ffffff !important;
          border-radius: 0.375rem;
          padding: 0.35rem 0.75rem !important;
          font-size: 0.75rem !important;
          font-weight: 600;
      }
      .custom-swal-button:hover {
          background-color: #333333 !important;
          color: #ffffff !important;
      }
  `;
  document.head.appendChild(style);

  // Get CSRF token
  function getCsrfToken() {
    const token = document.querySelector('input[name="csrfmiddlewaretoken"]');
    return token ? token.value : '';
  }

  document.addEventListener('DOMContentLoaded', () => {
    // Image Preview
    const imageInput = document.getElementById('imageUpload');
    if (imageInput) {
      imageInput.addEventListener('change', function () {
        const file = this.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = e => {
            const preview = document.getElementById('imagePreview');
            preview.style.backgroundImage = `url(${e.target.result})`;
            preview.style.backgroundSize = 'cover';
            preview.style.backgroundPosition = 'center';
          };
          reader.readAsDataURL(file);
        }
      });
    }

    // Handle form submit (shared function)
    async function handleFormSubmit(e, formId) {
      e.preventDefault();
      const formData = new FormData(e.target);

      try {
        const response = await fetch("{% url 'account' %}", {
          method: "POST",
          body: formData,
          headers: { "X-CSRFToken": getCsrfToken() },
        });

        const result = await response.json();
        if (response.ok && result.success) {
          Swal.fire({
            icon: "success",
            title: result.message,
            customClass: {
              popup: "custom-swal-popup",
              confirmButton: "custom-swal-button"
            },
            timer: 3000,
            showConfirmButton: false
          }).then(() => window.location.reload());
        } else {
          Swal.fire({
            icon: "error",
            title: result.error || `Server error: ${response.status}`,
            customClass: {
              popup: "custom-swal-popup",
              confirmButton: "custom-swal-button"
            },
            timer: 3000,
            showConfirmButton: false
          });
        }
      } catch (error) {
        Swal.fire({
          icon: "error",
          title: "Network error",
          text: error.message,
          customClass: {
            popup: "custom-swal-popup",
            confirmButton: "custom-swal-button"
          },
          timer: 3000,
          showConfirmButton: false
        });
      }
    }

    // Bind forms
    const profileForm = document.getElementById("profile-form");
    if (profileForm) profileForm.addEventListener("submit", e => handleFormSubmit(e, "profile-form"));

    const passwordForm = document.getElementById("password-form");
    if (passwordForm) passwordForm.addEventListener("submit", e => handleFormSubmit(e, "password-form"));

    // Password toggle
    document.querySelectorAll(".toggle-password").forEach(button => {
      button.addEventListener("click", () => {
        const input = button.previousElementSibling;
        const eyeOpen = button.querySelector(".eye-open");
        const eyeClosed = button.querySelector(".eye-closed");
        if (input.type === "password") {
          input.type = "text";
          eyeOpen.classList.add("hidden");
          eyeClosed.classList.remove("hidden");
        } else {
          input.type = "password";
          eyeOpen.classList.remove("hidden");
          eyeClosed.classList.add("hidden");
        }
      });
    });
  });
</script>

</body>
</html>